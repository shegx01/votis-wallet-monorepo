# Votis Wallet Mobile - Warp Project Configuration

## Project Overview
Kotlin Multiplatform Mobile (KMM) application for Votis Wallet, supporting both Android and iOS platforms with Compose Multiplatform UI.

## Important Rules

### ðŸš« Build Management
- **Never run `./gradlew clean`** unless explicitly requested by the user
- **Never delete build directories** (`build/`, `.gradle/`, etc.) automatically
- **Preserve build cache** to maintain fast compilation times
- Only suggest cleaning builds when troubleshooting specific build issues

### ðŸš« Auto-Commit Policy  
- **Never automatically commit code changes** without explicit user approval
- **Always ask for confirmation** before running `git commit` commands
- **Never auto-push** to remote repositories
- Let the user review changes with `git status` and `git diff` before committing

### ðŸ“± Platform Support
- **Android**: Primary platform with full feature support
- **iOS**: Platform-specific features handled via expect/actual pattern
- **Resource Management**: Uses Compose Resources for cross-platform assets

### ðŸŽ¨ Design System
- **Typography**: Inter font family (Regular, Medium, SemiBold, Bold)
- **Icons**: Mix of custom drawable resources and Material Icons Extended
- **Theme**: Material3 with custom Votis color scheme and dimensions

## Development Workflow

### Code Quality
- **Formatting**: `./gradlew ktlintFormat` (run before commits)
- **Linting**: `./gradlew ktlintCheck` 
- **Static Analysis**: `./gradlew detekt`
- **Tests**: `./gradlew test` (always run before commits)

### Build Commands
```bash
# Development builds
./gradlew composeApp:build

# Run tests
./gradlew composeApp:test

# Format code (required before commits)
./gradlew ktlintFormat

# Check code quality
./gradlew ktlintCheck detekt
```

### Project Structure
```
composeApp/
â”œâ”€â”€ src/commonMain/
â”‚   â”œâ”€â”€ composeResources/
â”‚   â”‚   â”œâ”€â”€ drawable/          # Vector icons (ic_google, ic_apple, etc.)
â”‚   â”‚   â””â”€â”€ font/             # Inter font family files
â”‚   â””â”€â”€ kotlin/finance/votis/wallet/
â”‚       â”œâ”€â”€ ui/
â”‚       â”‚   â”œâ”€â”€ components/   # Reusable UI components
â”‚       â”‚   â””â”€â”€ theme/        # Typography, colors, dimensions
â”‚       â””â”€â”€ utils/            # Platform utilities
â”œâ”€â”€ src/androidMain/          # Android-specific implementations
â””â”€â”€ src/iosMain/             # iOS-specific implementations
```

## Dependencies
- **UI Framework**: Compose Multiplatform
- **Material Design**: Material3 + Material Icons Extended  
- **Platform**: Kotlin Multiplatform Mobile
- **Code Quality**: ktlint, detekt
- **Testing**: Kotlin Test

## Git Commit Guidelines
- Use conventional commit format: `type(scope): description`
- Keep messages under 72 characters
- Examples:
  - `feat(ui): add social login buttons`
  - `fix(android): resolve build configuration issue`
  - `refactor(theme): organize typography system`

## Architecture Overview

### Modular MVI Architecture
This project implements a **multi-module, MVI-based architecture** optimized for:
- **Build Performance**: Parallel compilation with incremental builds
- **Team Scalability**: Clear module boundaries and ownership
- **Maintainability**: Separation of concerns with well-defined interfaces
- **Testing**: Isolated unit tests per module

### Layer Structure
```
UI Layer (Compose)
    â†“ (Intents)
Presentation Layer (ViewModels + MVI)
    â†“ (Use Cases)
Domain Layer (Business Logic)
    â†“ (Repository Interfaces)
Data Layer (API + Storage)
```

### Module Architecture
```
mobile_votis_wallet/
â”œâ”€â”€ app/                         # Main application module
â”œâ”€â”€ composeApp/                  # Current legacy module (to be migrated)
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ core-common/            # Shared utilities, extensions
â”‚   â”œâ”€â”€ core-ui/                # Design system, MVI foundation
â”‚   â”œâ”€â”€ core-domain/            # Business logic, use cases
â”‚   â”œâ”€â”€ core-data/              # Repository implementations
â”‚   â”œâ”€â”€ core-network/           # Backend API client (Votis only)
â”‚   â””â”€â”€ core-di/                # Dependency injection (Koin)
â””â”€â”€ features/
    â”œâ”€â”€ feature-auth/           # Authentication flow
    â”œâ”€â”€ feature-onboarding/     # User registration
    â”œâ”€â”€ feature-wallet/         # Home dashboard, balance
    â”œâ”€â”€ feature-transactions/   # Send/receive/swap
    â””â”€â”€ feature-settings/       # User preferences
```

### MVI Pattern Implementation

**State Management:**
```kotlin
// Single immutable state per screen
data class WalletUiState(
    val balance: Balance = Balance.ZERO,
    val transactions: List<Transaction> = emptyList(),
    val isLoading: Boolean = false,
    val error: String? = null
)

// User intents/actions
sealed class WalletIntent {
    object LoadWallet : WalletIntent()
    object RefreshBalance : WalletIntent()
    data class SendTransaction(val amount: String, val recipient: String) : WalletIntent()
}

// ViewModel handles intents and emits states
class WalletViewModel : BaseViewModel<WalletUiState, WalletIntent>() {
    fun handleIntent(intent: WalletIntent) {
        when (intent) {
            is WalletIntent.LoadWallet -> loadWallet()
            // ...
        }
    }
}
```

### Backend Integration
**Mobile â†” Backend Communication:**
- **Single API Endpoint**: Only communicates with Votis Phoenix backend
- **Provider Agnostic**: Backend handles all wallet provider logic (Turnkey, etc.)
- **Authentication**: Passkey/biometric + session management
- **Request Signing**: Client-side ECDSA signing for API requests

### Dependency Flow
```
feature-* modules
    â†“
core-ui (MVI foundation)
    â†“
core-domain (use cases, repositories)
    â†“
core-data + core-network
    â†“
core-common
```

**Rules:**
- Features depend on core modules only
- Core modules follow layered dependency (no circular dependencies)
- Domain layer defines repository interfaces
- Data layer implements repositories

### Platform Abstractions
**expect/actual Pattern:**
```kotlin
// commonMain
expect class BiometricAuthenticator {
    suspend fun authenticate(): AuthResult
    fun isAvailable(): Boolean
}

// androidMain - Android BiometricPrompt
actual class BiometricAuthenticator { ... }

// iosMain - iOS LocalAuthentication
actual class BiometricAuthenticator { ... }
```

### Build Configuration

**Module Naming:**
- `core-*`: Foundation/infrastructure modules
- `feature-*`: User-facing feature modules
- `app`: Main application entry point

**Quality Gates:**
```bash
# Before any commit
./gradlew formatAndCheck      # ktlint + detekt
./gradlew test                # Run all tests
./gradlew composeApp:build    # Ensure compilation
```

**Gradle Configuration:**
- Shared build-logic for plugin management
- Version catalogs for dependency management
- Incremental compilation and build caching
- Parallel execution enabled

## Notes for Warp AI
- This project uses Compose Resources, not traditional Android resources
- Font files are loaded via `@Composable` functions due to Compose Resources requirements  
- Platform-specific code uses expect/actual declarations
- Always preserve existing build configurations and dependencies
- Material Icons Extended is available but custom drawables preferred for branded icons
- **Backend handles wallet providers**: Mobile only talks to Votis Phoenix API
- **MVI pattern**: All ViewModels follow intent â†’ state pattern
- **Module boundaries**: Respect dependency flow, no reverse dependencies
